üîπ 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ UUID-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";


üìå –ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ PostgreSQL, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é uuid_generate_v4() ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö UUID.

üìå –ó–∞—á–µ–º –Ω—É–∂–Ω–æ: —á—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å ID –∫–∞–∫ INT AUTO_INCREMENT, –∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å UUID ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ, –Ω–µ —Å–ø—É—Ñ–∏—Ç—Å—è, —É–¥–æ–±–Ω–æ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

üîπ 2. –¢–∞–±–ª–∏—Ü–∞ users
CREATE TABLE IF NOT EXISTS users (
   id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
   username VARCHAR(50) UNIQUE NOT NULL,
   password_hash TEXT NOT NULL,
   created_at TIMESTAMP DEFAULT NOW(),
   updated_at TIMESTAMP DEFAULT NOW()
);

–ü–æ–ª–µ	–¢–∏–ø	–°–º—ã—Å–ª
id	UUID	PK, –≥–µ–Ω–µ—Ä–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
username	VARCHAR(50)	–ª–æ–≥–∏–Ω, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
password_hash	TEXT	–ø–∞—Ä–æ–ª—å –≤ –∑–∞—Ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ
created_at	TIMESTAMP	–≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
updated_at	TIMESTAMP	–≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚Äî –ª–æ–≥–∏–Ω + hash + timestamps
‚ö†Ô∏è –í Java –º—ã –¥–æ–ª–∂–Ω—ã —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å –≤ SHA-256 / BCrypt.

üîπ 3. –¢–∞–±–ª–∏—Ü–∞ wallet (1 –∫ 1 —Å user)
CREATE TABLE IF NOT EXISTS wallet (
   user_id UUID PRIMARY KEY REFERENCES users(id) ON DELETE CASCADE ON UPDATE CASCADE,
   balance NUMERIC(14, 2) NOT NULL DEFAULT 0 CHECK (balance >= 0)
);

–ü–æ–ª–µ	–¢–∏–ø	–°–º—ã—Å–ª
user_id	UUID	PK + FK –Ω–∞ users.id
balance	NUMERIC	–¥–µ–Ω—å–≥–∏ (—Ç–æ—á–Ω—ã–π decimal, –Ω–µ double!)

üìå ON DELETE CASCADE ‚Äî –µ—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å —é–∑–µ—Ä–∞, –∫–æ—à–µ–ª—ë–∫ —É–¥–∞–ª–∏—Ç—Å—è —Å–∞–º.
üìå CHECK (balance >= 0) ‚Äî –Ω–µ–ª—å–∑—è —É–π—Ç–∏ –≤ –º–∏–Ω—É—Å.

üîπ 4. –¢–∞–±–ª–∏—Ü–∞ bets (—Å—Ç–∞–≤–∫–∏)
CREATE TABLE IF NOT EXISTS bets (
   id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
   user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
   amount NUMERIC(14, 2) NOT NULL CHECK (amount > 0),
   is_win BOOLEAN NOT NULL,
   created_at TIMESTAMP DEFAULT NOW()
);

–ü–æ–ª–µ	–°–º—ã—Å–ª
id	UUID, PK
user_id	FK –Ω–∞ users
amount	—Å—É–º–º–∞ —Å—Ç–∞–≤–∫–∏
is_win	–≤—ã–∏–≥—Ä–∞–ª true/false
created_at	–≤—Ä–µ–º—è —Å—Ç–∞–≤–∫–∏

üìå CHECK (amount > 0) ‚Äî —Å—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π.
üìå –õ–æ–≥–∏—á–Ω–æ ‚Äî –∫–∞–∂–¥–∞—è —Å—Ç–∞–≤–∫–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ —é–∑–µ—Ä—É.

üîπ 5. –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX idx_bets_user_id ON bets(user_id);


üîç –£—Å–∫–æ—Ä—è–µ—Ç –≤—ã–±–æ—Ä–∫—É:

SELECT * FROM bets WHERE user_id = ?


–ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ ‚Äî –º–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞ –±–æ–ª—å—à–æ–º –æ–±—ä—ë–º–µ.

üîπ 6. –¢–∞–±–ª–∏—Ü–∞ transactions (–∏—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π)
CREATE TABLE IF NOT EXISTS transactions (
   id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
   user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
   type VARCHAR(20) NOT NULL CHECK (type IN ('DEPOSIT', 'WITHDRAW', 'BET', 'WIN')),
   amount NUMERIC(14, 2) NOT NULL CHECK (amount <> 0),
   created_at TIMESTAMP DEFAULT NOW()
);


üìå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π –≤ –∫–æ—à–µ–ª—å–∫–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

type	–ø—Ä–∏–º–µ—Ä
DEPOSIT	–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ
WITHDRAW	–≤—ã–≤–æ–¥
BET	—Å—Ç–∞–≤–∫–∞ (—Å–ø–∏—Å–∞–Ω–∏–µ)
WIN	–≤—ã–∏–≥—Ä—ã—à (–ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ)

‚ö†Ô∏è CHECK (amount <> 0) ‚Äî –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ–º –Ω—É–ª–µ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

üîπ 7. –¢—Ä–∏–≥–≥–µ—Ä –Ω–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ updated_at
CREATE OR REPLACE FUNCTION update_timestamp()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
RETURN NEW;
END;
$$ LANGUAGE plpgsql;


üìå –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ updated_at –ø—Ä–∏ UPDATE.

CREATE TRIGGER trg_users_update
    BEFORE UPDATE ON users
    FOR EACH ROW EXECUTE FUNCTION update_timestamp();


üìå –¢—Ä–∏–≥–≥–µ—Ä: –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç updated_at.

üî• –¢–µ–ø–µ—Ä—å UPDATE users SET username = ... ‚Üí timestamp –æ–±–Ω–æ–≤–∏—Ç—Å—è —Å–∞–º.

‚úÖ –ò—Ç–æ–≥: –∑–∞—á–µ–º –≤—Å—ë —ç—Ç–æ?
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å	–ì–¥–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π ID	UUID everywhere
–û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª—ë–∫	wallet
–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π	transactions
–ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫	bets
No negative balance	CHECK constraint
Auto updated timestamps	trigger
–ë—ã—Å—Ç—Ä—ã–π SELECT –ø–æ —é–∑–µ—Ä—É	INDEX